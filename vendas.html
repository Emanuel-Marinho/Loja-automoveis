<!php include "php/alocacao.php">
<!php include "php/clientes.php">
<!php include "php/concessionarias.php">

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendas</title>
    <link rel="stylesheet" href="css/styleVendas.css">
</head>
<body>
    <div id="vendas-caixa">
        <h1 id="vendas-h1">Fiat Argo</h1>
        <form action="php/alter.php" method="POST">
            <div id="vendas-clientes"></div>
            <div id="vendas-conce"></div>

            <div id="vendas-btn">
                <button type="submit" class="vendas-btn">Confirmar</button>
            </div>
        </form>
    </div>

    <script>
        let titulo = localStorage.getItem("nome_veiculo");

        document.getElementById("vendas-h1").innerHTML = titulo;

        let conce = ""

        fetch("php/clientes.php")
        .then(function(response) {
            return response.json()
        })
        .then(function(data){
            console.log(data)

            let codHtml = '<Label class="vendas-espaco">Cliente:</Label>'+
            '<select>'+
            '<option disabled selected></option>'

            for(let i = 0; i < data.length; i++){
                codHtml += `<option>${data[i].nome}</option>`
            }
            codHtml += '</select><br><br>'

            document.getElementById("vendas-clientes").innerHTML = codHtml
        })
        .catch(function(error){
            console.log(error);
        })

        fetch("php/alocacao.php")
        .then(function(response){
            return response.json()
        })
        .then(function(data){
            console.log(data)

            let id_veiculo = localStorage.getItem("id_veiculo")

            for(let i=0; i<data.length; i++){
                if(data[i].automovel == id_veiculo){
                    conce = data[i].concessionaria
                }
            }
        })
        .catch(function(error){
            console.log(error);
        })

        fetch("php/concessionarias.php")
        .then(function(response){
            return response.json()
        })
        .then(function(data){
            console.log(data)

            let codHtml = '<Label>Concessionaria:</Label>'+
            '<select name="id">'+
            '<option value="" disabled selected></option>'

            for(let i = 0; i < data.length; i++){
                if(data[i].id == conce){
                    console.log(data[i].id)
                    codHtml += `<option value="${data[i].id}">${data[i].concessionaria}</option>`
                }
            }
            codHtml += '</select><br><br>'

            document.getElementById("vendas-conce").innerHTML = codHtml
        })
        .catch(function(error){
            console.log(error);
        })
    </script>
</body>
</html>